# =============================================================================
# Project makefile
# =============================================================================

# Settings
main_objs = main.obj init.obj utils.obj config.obj mm.obj
renderer_objs = vec.obj ray.obj renderer.obj sphere.obj object.obj scene.obj cam.obj hit.obj triangle.obj aabb.obj
material_objs = mat.obj lmbrtian.obj metal.obj unlit.obj emissive.obj
texture_objs = solid.obj texture.obj tiles.obj image.obj
output_objs = bmp.obj video.obj
gui_objs = gui.obj
input_objs = bmpread.obj objload.obj

testobjs = init.obj test.obj utils.obj vec.obj ray.obj

objs = $(main_objs) $(renderer_objs) $(material_objs) $(texture_objs) $(output_objs) $(gui_objs) $(input_objs)

dest = raytracer.exe

# =============================================================================
# Do NOT edit this section, unless you know what you are doing.
# =============================================================================
.asm: rt/
.asm: rt/mat/
.asm: rt/texture/
.asm: output/
.asm: gui/
.asm: input/
.asm.obj:
  tasm /ml /m2 /w2 /z /zi /p /jIDEAL $<

$(dest): $(objs)
#  wlink option quiet system pmodew name $@ file {$(objs)}
  wlink option quiet system pmodew name $@ file *.obj

tests: $(testobjs) .symbolic
  wlink option quiet system pmodew name tests.exe file *.obj

clean: .symbolic
  del *.obj
  del tests.exe
  del $(dest)

.silent
debug: $(objs) .symbolic
  wlink debug watcom lines option Q,C system pmodew name $(dest) file *.obj
  wd /tr=rsi /li=43 $(dest)

.silent
debugtests: $(testobjs) .symbolic
  wlink debug watcom lines option Q,C system pmodew name tests.exe file *.obj
  wd /tr=rsi /li=43 tests.exe